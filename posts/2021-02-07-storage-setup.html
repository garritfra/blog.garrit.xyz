<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-1691189015"/><meta charSet="utf-8" class="jsx-1691189015"/><title class="jsx-1691189015">My storage setup (Feburary 2021)</title><meta name="Description" content="Random thoughts, tips and rants about software" class="jsx-1691189015"/><link rel="icon" type="image/svg+xml" href="/favicon.svg" class="jsx-1691189015"/><script async="" defer="" data-domain="blog.garrit.xyz" src="https://analytics.slashdev.space/js/plausible.js" class="jsx-1691189015"></script><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://blog.garrit.xyz/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="https://blog.garrit.xyz/_next/static/chunks/webpack-86566091d0b199a92290.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/main-b9780dc6f4fa7abb3771.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/pages/_app-f60f910fc98ee492d09b.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/461-580d7f3971c2a1d066aa.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/pages/posts/%5Bpost%5D-ce733d0ad8d4ec9b6f4f.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/TDYLP5FAulqjSBNDujBIc/_buildManifest.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/TDYLP5FAulqjSBNDujBIc/_ssgManifest.js" defer=""></script><style id="__jsx-1691189015">@import url("https://fonts.googleapis.com/css?family=Work+Sans&display=swap");*{box-sizing:inherit;}html{box-sizing:border-box;overflow-y:scroll;}body{margin:0;font-family:"Work Sans","Helvetica Neue",Helvetica, sans-serif;overflow-x:hidden;color:#000;font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}a{-webkit-text-decoration:none;text-decoration:none;color:inherit;-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;}a:hover{-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;opacity:0.5;-webkit-text-decoration-color:inherit;text-decoration-color:inherit;}ul{margin:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;list-style-position:inside;list-style-image:none;}ol{margin:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;list-style-position:inside;list-style-image:none;}ul,ol,p{margin-bottom:1.45rem;}img{max-width:100%;}img,figure,table,fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;margin-bottom:1.45rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem;}table{line-height:1.45rem;border-collapse:collapse;width:100%;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}strong{font-weight:bold;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li>ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li>ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li>p{margin-bottom:calc(1.45rem / 2);}code{line-height:1.45rem;}p code{background:hsla(0,0%,0%,0.1);padding:0 0.4rem;}@media (prefers-reduced-motion){*{-webkit-transition:none !important;transition:none !important;}}h1,h2,h3,h4,h5,h6,p{font-family:"Work Sans","Helvetica Neue",Helvetica, sans-serif;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;text-rendering:optimizeLegibility;}h1,h2,h3,h4{font-weight:500;}h1{font-size:3rem;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;line-height:1.1875;}h2{font-size:2.5rem;-webkit-letter-spacing:-0.75px;-moz-letter-spacing:-0.75px;-ms-letter-spacing:-0.75px;letter-spacing:-0.75px;line-height:1.2;}h3{font-size:1.7rem;line-height:1.1875;color:#a0a0a0;font-weight:normal;}h4{font-size:1.3rem;}p,li{font-size:1.2rem;-webkit-letter-spacing:-0.5px;-moz-letter-spacing:-0.5px;-ms-letter-spacing:-0.5px;letter-spacing:-0.5px;line-height:1.5;color:#464646;}@media (min-width:1280px){h1{-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;line-height:1.1875;}h2{-webkit-letter-spacing:-0.75px;-moz-letter-spacing:-0.75px;-ms-letter-spacing:-0.75px;letter-spacing:-0.75px;line-height:1.1667;}h3{-webkit-letter-spacing:-0.5px;-moz-letter-spacing:-0.5px;-ms-letter-spacing:-0.5px;letter-spacing:-0.5px;line-height:1.1875;color:#a0a0a0;font-weight:normal;}p{line-height:1.4375;}}.page__body a,.page__footer a{-webkit-text-decoration:underline;text-decoration:underline;}@media (prefers-color-scheme:dark){:root{background-color:#161618;color:#dbd7db;}html{-webkit-scrollbar-color:#dbd7db #161618 !important;-moz-scrollbar-color:#dbd7db #161618 !important;-ms-scrollbar-color:#dbd7db #161618 !important;scrollbar-color:#dbd7db #161618 !important;}h1,h2,h3,h4,p,pre,a,ul,li,blog__body>*{color:#dbd7db;}.button__link{background-color:#67676c;}a{color:#dbd7db;}article a[href^="http"]::after,article a[href^="https://"]::after{-webkit-filter:invert(100%);filter:invert(100%);}}article a[href^="http"]::after,article a[href^="https://"]::after{content:"";width:11px;height:11px;margin-left:4px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z'/%3E%3Cpath fill-rule='evenodd' d='M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z'/%3E%3C/svg%3E");background-position:center;background-repeat:no-repeat;background-size:contain;display:inline-block;}</style><style id="__jsx-1467018370">h1.jsx-1467018370{margin-bottom:0;}h1.jsx-1467018370:hover{cursor:pointer;}nav.jsx-1467018370{padding:1.5rem 1.25rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (min-width:768px){.header.jsx-1467018370{height:100vh;position:fixed;left:0;top:0;}.nav.jsx-1467018370{padding:2rem;width:30vw;height:100%;border-bottom:none;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><style id="__jsx-3897018903">.page.jsx-3897018903 h1.jsx-3897018903{margin-bottom:0.7rem;}.page__hero.jsx-3897018903{min-height:300px;height:60vh;width:100%;margin:0;overflow:hidden;}.page__hero.jsx-3897018903 img.jsx-3897018903{margin-bottom:0;object-fit:cover;min-height:100%;min-width:100%;object-position:center;}.page__info.jsx-3897018903{padding:1.5rem 1.25rem;width:100%;max-width:768px;margin:0 auto;}.page__info.jsx-3897018903 h1.jsx-3897018903{margin-bottom:0.66rem;}.page__info.jsx-3897018903 h3.jsx-3897018903{margin-bottom:0;}.page__body.jsx-3897018903{width:100%;padding:0 1.25rem;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.page__body.jsx-3897018903 a.jsx-3897018903{-webkit-text-decoration:underline;text-decoration:underline;padding-bottom:1.5rem;}.page__body.jsx-3897018903:last-child{margin-bottom:0;}.page__body.jsx-3897018903 h1.jsx-3897018903 h2.jsx-3897018903 h3.jsx-3897018903 h4.jsx-3897018903 h5.jsx-3897018903 h6.jsx-3897018903 p.jsx-3897018903{font-weight:normal;}.page__body.jsx-3897018903 ul.jsx-3897018903{list-style-type:circle;}.page__body.jsx-3897018903 ul.jsx-3897018903 ol.jsx-3897018903{margin-left:1.25rem;margin-bottom:1.25rem;padding-left:1.45rem;}.page__footer.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:1.5rem 1.25rem;width:100%;max-width:800px;margin:0 auto;}.page__footer.jsx-3897018903 h2.jsx-3897018903{margin-bottom:0;}.page__footer.jsx-3897018903 a.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.page__footer.jsx-3897018903 a.jsx-3897018903 svg.jsx-3897018903{width:20px;}@media (max-width:768px){.page__footer.jsx-3897018903{display:none;}}@media (min-width:768px){.page.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.page__body.jsx-3897018903{max-width:800px;padding:0 2rem;}.page__body.jsx-3897018903 span.jsx-3897018903{width:100%;margin:1.5rem auto;}.page__body.jsx-3897018903 ul.jsx-3897018903 ol.jsx-3897018903{margin-left:1.5rem;margin-bottom:1.5rem;}.page__hero.jsx-3897018903{min-height:600px;height:75vh;}.page__info.jsx-3897018903{text-align:center;padding:2rem 0;}.page__info.jsx-3897018903 h1.jsx-3897018903{max-width:500px;margin:0 auto 0.66rem auto;}.page__footer.jsx-3897018903{padding:2.25rem;}}@media (min-width:1440px){.page__hero.jsx-3897018903{height:70vh;}.page__info.jsx-3897018903{padding:3rem 0;}.page__footer.jsx-3897018903{padding:2rem 2rem 3rem 2rem;}}</style><style id="__jsx-3553209867">img.jsx-3553209867{width:12rem;}Link.jsx-3553209867{margin:1rem;}@media (max-width:767px){.profile.jsx-3553209867{padding:1.5rem 1.25rem;}}</style><style id="__jsx-3605278554">.layout.jsx-3605278554{overflow-x:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.layout.jsx-3605278554 .info_page.jsx-3605278554{color:#ebebeb;}.content.jsx-3605278554{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:768px){.layout.jsx-3605278554{display:block;}.content.jsx-3605278554{-webkit-box-flex:none;-webkit-flex-grow:none;-ms-flex-positive:none;flex-grow:none;width:70vw;margin-left:30vw;}}</style></head><body><div id="__next"><section class="jsx-3605278554 layout"><header class="jsx-1467018370 header"><nav role="navigation" aria-label="main navigation" class="jsx-1467018370 nav"><a href="/" class="jsx-1467018370"><h1 class="jsx-1467018370">~/garrit</h1></a></nav></header><div class="jsx-3605278554 content"><article class="jsx-3897018903 blog"><div class="jsx-3897018903 page__info"><h1 class="jsx-3897018903">My storage setup (Feburary 2021)</h1></div><div class="jsx-3897018903 page__body"><p>I used to rely on Google Drive and Photos to store my entire data. Now, that <a href="https://blog.google/products/photos/storage-changes/">Google has decided to ditch unlimited photo storage in the near future</a> and Google basically being the devil himself, I decided to step up my game and get my hands dirty on a DIY storage solution.</p><h2>The goal</h2><p>Before I got started, I thought about the expectations I have towards a system like this. It boils down to these four points (in this order): I want my solution to be <strong>resiliant</strong>, <strong>scalable</strong>, <strong>easy to maintain</strong> and <strong>easy to access</strong>. Looking back, I think I met all of these requirements fairly well. Let me walk you through how I managed to do that.</p><h2>Data resiliance</h2><p>Keeping data on a single device is obviously a really bad idea. Drives eventually fail, which means that your data will be lost. Heck, even my house could burn down, which means that any number of local copies could burn to ashes. To prevent data loss, I strictly adhere to the <a href="https://www.backblaze.com/blog/the-3-2-1-backup-strategy/">3-2-1 backup strategy</a>. A 3-2-1 strategy means having <strong>at least three total copies of your data, two of which are local but on different mediums (read: devices), and at least one copy off-site</strong>. If a drive fails, I can replace it. If my house burns down, I get two new drives and clone my offsite backup to them.</p><p>To get an offsite backup, I set up a spare Raspberry Pi with a single large HDD and instructed it to do daily backups of my entire data. I asked a family member if they would be willing to have a tiny computer plugged in to their router 24/7, and they kindly agreed. A Pi and a HDD are very efficient in terms of power, so there is not a lot to worry about.</p><h2>Scalability</h2><p>I currently don&#x27;t have a huge amount of data. If that were to change (i.e. if I continue to shoot a lot of high-res photos and shove them into my setup), I need a way to simply attach more drives, or ones with more capacity. I looked at different file-systems that allowed to easy extendability while also being resiliant.</p><p>An obvious candidate was <strong>ZFS</strong>, but there are a couple of reasons I ditched this idea. First of all, it is really hard to get up and running on Raspberry Pi running Linux, since it&#x27;s not natively supported by all distributions. This increases the complexity of the setup. Another reason is that I don&#x27;t like the way it scales. Please correct me if I&#x27;m wrong here, since I only did limited research on this. From what I know though, ZFS can only be extended by shoving a large amount of drives in the setup to achieve perfect redundancy.</p><p>In the end, I settled on <strong>BTRFS</strong>. For me, it scratches all the itches that ZFS has. It is baked into the linux kernel, which makes it really easy to install on most distributions, and I can scale it to any number of drives I want. If I find a spare drive somewhere with any storage capacity, I can plug it into the system and it will just work, without having to think about balancing or redundancy shenanigans.</p><h2>Maintainability</h2><p>I need my setup to be easy to maintain. If a drive fails, I want to be able to replace it within a matter of minutes, not hours. If my host (a Raspberry Pi) bursts into flames, I want to be able to swap in a new one and still access my data. If I&#x27;m out and about and something goes south, I want to be able to fix it remotely. BTRFS helps a lot here. It&#x27;s really the foundation for all the key points mentioned here. It gives me a simple interface to maintain the data on the drives, and tries to fix issues itself whenever possible.</p><p>Exposing random ports to the general public is a huge security risk. To still be able to access the Pi remotely, I set up <strong>an encrypted WireGuard tunnel</strong>. This way, I only have to expose a single port for WireGuard to talk to the device as if I&#x27;m sitting next to it.</p><h2>Accessibility</h2><p>Since the data needs to be accessed frequently, I need a simple interface for it that can be used on any device. I decided to host a <strong>Nextcloud</strong> instance and mount the drive as external storage. Why external storage? Because Nextcloud does some weird thing with the data it stores. If I decide to ditch Nextcloud at some point, I have the data on the disks &quot;as is&quot;, without some sort of abstraction on top of it. This also has the benefit of allowing access from multiple sources. I don&#x27;t have to use Nextcloud, but instead can mount the volume as a FTP, SMB or NFS share and do whatever I want with it. From the nextcloud perspective, this has some drawbacks like inefficient caching or file detection, but I&#x27;m willing to make that tradeoff.</p><h2>In a nutshell</h2><p>This entire setup cost me about 150€ in total. Some components were scraped from old PC parts. So, what does the solution look like? Here is the gist:</p><ul><li>A Raspberry Pi 4 as a main host and an older Raspberry Pi 3 for offsite backup, both running Raspberry Pi OS</li><li>Two external harddrives in a RAID 1 (mirrored) configuration, running on an external USB3 hub</li><li>A single internal HDD that served no purpose in my old PC, now serving as backup storage</li><li>All drives are using BTRFS</li><li>WireGuard tunnels between main and remote host, as well as most access devices</li><li>Nextcloud on main host, accessible over TLS (if I need to access data from outside the secure tunnel-network)</li><li>SMB share accessible from within the tunnel-network</li><li>Circa 4.5 terabyte total disk size; 1.5 terabyte of usable storage</li><li>Snapper for local incremental backups on main host; BTRBK for remote incremental backups</li><li>Cron jobs for regular backups and repairs (scrub/rebalance)</li></ul><p>This is post 010 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><p>If you enjoyed this post, consider<!-- --> <a href="https://donate.slashdev.space">buying me a coffee</a>! Got comments? Send me a<!-- --> <a href="mailto:garrit@slashdev.space">Mail</a>, or shoot me a message on<!-- --> <a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a>.</p><div class="blog__footer"><h2>Written By: Garrit Franke</h2></div></div><div class="jsx-3897018903 page__footer"></div></article></div><div class="jsx-3553209867 profile"><h2 class="jsx-3553209867">Garrit Franke</h2><p class="jsx-3553209867">Random thoughts, tips and rants about software</p><br class="jsx-3553209867"/><a href="https://garrit.xyz">Website</a><br class="jsx-3553209867"/><a href="https://github.com/garritfra">Github</a><br class="jsx-3553209867"/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br class="jsx-3553209867"/><a href="mailto:garrit@slashdev.space">Email</a><br class="jsx-3553209867"/><a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a><br class="jsx-3553209867"/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP</a><br class="jsx-3553209867"/><a href="/rss.xml">RSS</a></div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"~/garrit","frontmatter":{"title":"My storage setup (Feburary 2021)","date":"2021-02-07"},"markdownBody":"\nI used to rely on Google Drive and Photos to store my entire data. Now, that [Google has decided to ditch unlimited photo storage in the near future](https://blog.google/products/photos/storage-changes/) and Google basically being the devil himself, I decided to step up my game and get my hands dirty on a DIY storage solution.\n\n## The goal\n\nBefore I got started, I thought about the expectations I have towards a system like this. It boils down to these four points (in this order): I want my solution to be **resiliant**, **scalable**, **easy to maintain** and **easy to access**. Looking back, I think I met all of these requirements fairly well. Let me walk you through how I managed to do that.\n\n## Data resiliance\n\nKeeping data on a single device is obviously a really bad idea. Drives eventually fail, which means that your data will be lost. Heck, even my house could burn down, which means that any number of local copies could burn to ashes. To prevent data loss, I strictly adhere to the [3-2-1 backup strategy](https://www.backblaze.com/blog/the-3-2-1-backup-strategy/). A 3-2-1 strategy means having **at least three total copies of your data, two of which are local but on different mediums (read: devices), and at least one copy off-site**. If a drive fails, I can replace it. If my house burns down, I get two new drives and clone my offsite backup to them.\n\nTo get an offsite backup, I set up a spare Raspberry Pi with a single large HDD and instructed it to do daily backups of my entire data. I asked a family member if they would be willing to have a tiny computer plugged in to their router 24/7, and they kindly agreed. A Pi and a HDD are very efficient in terms of power, so there is not a lot to worry about.\n\n## Scalability\n\nI currently don't have a huge amount of data. If that were to change (i.e. if I continue to shoot a lot of high-res photos and shove them into my setup), I need a way to simply attach more drives, or ones with more capacity. I looked at different file-systems that allowed to easy extendability while also being resiliant.\n\nAn obvious candidate was **ZFS**, but there are a couple of reasons I ditched this idea. First of all, it is really hard to get up and running on Raspberry Pi running Linux, since it's not natively supported by all distributions. This increases the complexity of the setup. Another reason is that I don't like the way it scales. Please correct me if I'm wrong here, since I only did limited research on this. From what I know though, ZFS can only be extended by shoving a large amount of drives in the setup to achieve perfect redundancy.\n\nIn the end, I settled on **BTRFS**. For me, it scratches all the itches that ZFS has. It is baked into the linux kernel, which makes it really easy to install on most distributions, and I can scale it to any number of drives I want. If I find a spare drive somewhere with any storage capacity, I can plug it into the system and it will just work, without having to think about balancing or redundancy shenanigans.\n\n## Maintainability\n\nI need my setup to be easy to maintain. If a drive fails, I want to be able to replace it within a matter of minutes, not hours. If my host (a Raspberry Pi) bursts into flames, I want to be able to swap in a new one and still access my data. If I'm out and about and something goes south, I want to be able to fix it remotely. BTRFS helps a lot here. It's really the foundation for all the key points mentioned here. It gives me a simple interface to maintain the data on the drives, and tries to fix issues itself whenever possible.\n\nExposing random ports to the general public is a huge security risk. To still be able to access the Pi remotely, I set up **an encrypted WireGuard tunnel**. This way, I only have to expose a single port for WireGuard to talk to the device as if I'm sitting next to it.\n\n## Accessibility\n\nSince the data needs to be accessed frequently, I need a simple interface for it that can be used on any device. I decided to host a **Nextcloud** instance and mount the drive as external storage. Why external storage? Because Nextcloud does some weird thing with the data it stores. If I decide to ditch Nextcloud at some point, I have the data on the disks \"as is\", without some sort of abstraction on top of it. This also has the benefit of allowing access from multiple sources. I don't have to use Nextcloud, but instead can mount the volume as a FTP, SMB or NFS share and do whatever I want with it. From the nextcloud perspective, this has some drawbacks like inefficient caching or file detection, but I'm willing to make that tradeoff.\n\n## In a nutshell\n\nThis entire setup cost me about 150€ in total. Some components were scraped from old PC parts. So, what does the solution look like? Here is the gist:\n\n- A Raspberry Pi 4 as a main host and an older Raspberry Pi 3 for offsite backup, both running Raspberry Pi OS\n- Two external harddrives in a RAID 1 (mirrored) configuration, running on an external USB3 hub\n- A single internal HDD that served no purpose in my old PC, now serving as backup storage\n- All drives are using BTRFS\n- WireGuard tunnels between main and remote host, as well as most access devices\n- Nextcloud on main host, accessible over TLS (if I need to access data from outside the secure tunnel-network)\n- SMB share accessible from within the tunnel-network\n- Circa 4.5 terabyte total disk size; 1.5 terabyte of usable storage\n- Snapper for local incremental backups on main host; BTRBK for remote incremental backups\n- Cron jobs for regular backups and repairs (scrub/rebalance)\n\nThis is post 010 of [#100DaysToOffload](https://100daystooffload.com/).\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-02-07-storage-setup"},"buildId":"TDYLP5FAulqjSBNDujBIc","assetPrefix":"https://blog.garrit.xyz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>