<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-1691189015"/><meta charSet="utf-8" class="jsx-1691189015"/><title class="jsx-1691189015">Docker healthchecks using healthchecks.io</title><meta name="Description" content="Random thoughts, tips and rants about software" class="jsx-1691189015"/><link rel="icon" type="image/svg+xml" href="/favicon.svg" class="jsx-1691189015"/><script async="" defer="" data-domain="blog.garrit.xyz" src="https://analytics.slashdev.space/js/plausible.js" class="jsx-1691189015"></script><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://blog.garrit.xyz/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="https://blog.garrit.xyz/_next/static/chunks/webpack-86566091d0b199a92290.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/main-b9780dc6f4fa7abb3771.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/pages/_app-f60f910fc98ee492d09b.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/461-580d7f3971c2a1d066aa.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/chunks/pages/posts/%5Bpost%5D-ce733d0ad8d4ec9b6f4f.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/xx65xxz0JF_KOU9mEOU3_/_buildManifest.js" defer=""></script><script src="https://blog.garrit.xyz/_next/static/xx65xxz0JF_KOU9mEOU3_/_ssgManifest.js" defer=""></script><style id="__jsx-1691189015">@import url("https://fonts.googleapis.com/css?family=Work+Sans&display=swap");*{box-sizing:inherit;}html{box-sizing:border-box;overflow-y:scroll;}body{margin:0;font-family:"Work Sans","Helvetica Neue",Helvetica, sans-serif;overflow-x:hidden;color:#000;font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}a{-webkit-text-decoration:none;text-decoration:none;color:inherit;-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;}a:hover{-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;opacity:0.5;-webkit-text-decoration-color:inherit;text-decoration-color:inherit;}ul{margin:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;list-style-position:inside;list-style-image:none;}ol{margin:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;list-style-position:inside;list-style-image:none;}ul,ol,p{margin-bottom:1.45rem;}img{max-width:100%;}img,figure,table,fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;margin-bottom:1.45rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem;}table{line-height:1.45rem;border-collapse:collapse;width:100%;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}strong{font-weight:bold;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li>ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li>ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li>p{margin-bottom:calc(1.45rem / 2);}code{line-height:1.45rem;}p code{background:hsla(0,0%,0%,0.1);padding:0 0.4rem;}@media (prefers-reduced-motion){*{-webkit-transition:none !important;transition:none !important;}}h1,h2,h3,h4,h5,h6,p{font-family:"Work Sans","Helvetica Neue",Helvetica, sans-serif;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;text-rendering:optimizeLegibility;}h1,h2,h3,h4{font-weight:500;}h1{font-size:3rem;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;line-height:1.1875;}h2{font-size:2.5rem;-webkit-letter-spacing:-0.75px;-moz-letter-spacing:-0.75px;-ms-letter-spacing:-0.75px;letter-spacing:-0.75px;line-height:1.2;}h3{font-size:1.7rem;line-height:1.1875;color:#a0a0a0;font-weight:normal;}h4{font-size:1.3rem;}p,li{font-size:1.2rem;-webkit-letter-spacing:-0.5px;-moz-letter-spacing:-0.5px;-ms-letter-spacing:-0.5px;letter-spacing:-0.5px;line-height:1.5;color:#464646;}@media (min-width:1280px){h1{-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;line-height:1.1875;}h2{-webkit-letter-spacing:-0.75px;-moz-letter-spacing:-0.75px;-ms-letter-spacing:-0.75px;letter-spacing:-0.75px;line-height:1.1667;}h3{-webkit-letter-spacing:-0.5px;-moz-letter-spacing:-0.5px;-ms-letter-spacing:-0.5px;letter-spacing:-0.5px;line-height:1.1875;color:#a0a0a0;font-weight:normal;}p{line-height:1.4375;}}.page__body a,.page__footer a{-webkit-text-decoration:underline;text-decoration:underline;}@media (prefers-color-scheme:dark){:root{background-color:#161618;color:#dbd7db;}html{-webkit-scrollbar-color:#dbd7db #161618 !important;-moz-scrollbar-color:#dbd7db #161618 !important;-ms-scrollbar-color:#dbd7db #161618 !important;scrollbar-color:#dbd7db #161618 !important;}h1,h2,h3,h4,p,pre,a,ul,li,blog__body>*{color:#dbd7db;}.button__link{background-color:#67676c;}a{color:#dbd7db;}article a[href^="http"]::after,article a[href^="https://"]::after{-webkit-filter:invert(100%);filter:invert(100%);}}article a[href^="http"]::after,article a[href^="https://"]::after{content:"";width:11px;height:11px;margin-left:4px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z'/%3E%3Cpath fill-rule='evenodd' d='M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z'/%3E%3C/svg%3E");background-position:center;background-repeat:no-repeat;background-size:contain;display:inline-block;}</style><style id="__jsx-1467018370">h1.jsx-1467018370{margin-bottom:0;}h1.jsx-1467018370:hover{cursor:pointer;}nav.jsx-1467018370{padding:1.5rem 1.25rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (min-width:768px){.header.jsx-1467018370{height:100vh;position:fixed;left:0;top:0;}.nav.jsx-1467018370{padding:2rem;width:30vw;height:100%;border-bottom:none;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><style id="__jsx-3897018903">.page.jsx-3897018903 h1.jsx-3897018903{margin-bottom:0.7rem;}.page__hero.jsx-3897018903{min-height:300px;height:60vh;width:100%;margin:0;overflow:hidden;}.page__hero.jsx-3897018903 img.jsx-3897018903{margin-bottom:0;object-fit:cover;min-height:100%;min-width:100%;object-position:center;}.page__info.jsx-3897018903{padding:1.5rem 1.25rem;width:100%;max-width:768px;margin:0 auto;}.page__info.jsx-3897018903 h1.jsx-3897018903{margin-bottom:0.66rem;}.page__info.jsx-3897018903 h3.jsx-3897018903{margin-bottom:0;}.page__body.jsx-3897018903{width:100%;padding:0 1.25rem;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.page__body.jsx-3897018903 a.jsx-3897018903{-webkit-text-decoration:underline;text-decoration:underline;padding-bottom:1.5rem;}.page__body.jsx-3897018903:last-child{margin-bottom:0;}.page__body.jsx-3897018903 h1.jsx-3897018903 h2.jsx-3897018903 h3.jsx-3897018903 h4.jsx-3897018903 h5.jsx-3897018903 h6.jsx-3897018903 p.jsx-3897018903{font-weight:normal;}.page__body.jsx-3897018903 ul.jsx-3897018903{list-style-type:circle;}.page__body.jsx-3897018903 ul.jsx-3897018903 ol.jsx-3897018903{margin-left:1.25rem;margin-bottom:1.25rem;padding-left:1.45rem;}.page__footer.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:1.5rem 1.25rem;width:100%;max-width:800px;margin:0 auto;}.page__footer.jsx-3897018903 h2.jsx-3897018903{margin-bottom:0;}.page__footer.jsx-3897018903 a.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.page__footer.jsx-3897018903 a.jsx-3897018903 svg.jsx-3897018903{width:20px;}@media (max-width:768px){.page__footer.jsx-3897018903{display:none;}}@media (min-width:768px){.page.jsx-3897018903{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.page__body.jsx-3897018903{max-width:800px;padding:0 2rem;}.page__body.jsx-3897018903 span.jsx-3897018903{width:100%;margin:1.5rem auto;}.page__body.jsx-3897018903 ul.jsx-3897018903 ol.jsx-3897018903{margin-left:1.5rem;margin-bottom:1.5rem;}.page__hero.jsx-3897018903{min-height:600px;height:75vh;}.page__info.jsx-3897018903{text-align:center;padding:2rem 0;}.page__info.jsx-3897018903 h1.jsx-3897018903{max-width:500px;margin:0 auto 0.66rem auto;}.page__footer.jsx-3897018903{padding:2.25rem;}}@media (min-width:1440px){.page__hero.jsx-3897018903{height:70vh;}.page__info.jsx-3897018903{padding:3rem 0;}.page__footer.jsx-3897018903{padding:2rem 2rem 3rem 2rem;}}</style><style id="__jsx-3553209867">img.jsx-3553209867{width:12rem;}Link.jsx-3553209867{margin:1rem;}@media (max-width:767px){.profile.jsx-3553209867{padding:1.5rem 1.25rem;}}</style><style id="__jsx-3605278554">.layout.jsx-3605278554{overflow-x:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.layout.jsx-3605278554 .info_page.jsx-3605278554{color:#ebebeb;}.content.jsx-3605278554{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:768px){.layout.jsx-3605278554{display:block;}.content.jsx-3605278554{-webkit-box-flex:none;-webkit-flex-grow:none;-ms-flex-positive:none;flex-grow:none;width:70vw;margin-left:30vw;}}</style></head><body><div id="__next"><section class="jsx-3605278554 layout"><header class="jsx-1467018370 header"><nav role="navigation" aria-label="main navigation" class="jsx-1467018370 nav"><a href="/" class="jsx-1467018370"><h1 class="jsx-1467018370">~/garrit</h1></a></nav></header><div class="jsx-3605278554 content"><article class="jsx-3897018903 blog"><div class="jsx-3897018903 page__info"><h1 class="jsx-3897018903">Docker healthchecks using healthchecks.io</h1></div><div class="jsx-3897018903 page__body"><p>I&#x27;m currently in the midst of improving the monitoring of my infrastructure. I
make heavy use of docker and docker-compose for my hosting, so it&#x27;s vital to add
monitoring for most of the containers.</p><p>I&#x27;m hosting my own instance of <a href="https://healthchecks.io/">healthchecks.io</a>.
Their solution to monitoring involves <strong>you</strong> having to ping <strong>them</strong>, instead
of the other way around. This let&#x27;s you add healthchecks to virtually anything
that can ping a http-endpoint.</p><p>docker-compose let&#x27;s you define healthchecks to your config that, when
completing sucessfully, mark the container as &quot;healthy&quot;. The process of adding
such a healthcheck is simple. First, create a new check in your healthchecks.io
account and set the ping interval to 1 minute, or a value you prefer. Then, add
this snippet to your docker-compose file:</p><pre><code class="language-yaml">app:
    image: nextcloud
    ports:
        - 127.0.0.1:8080:80
    healthcheck:
        test:
            [
                &quot;CMD&quot;,
                &quot;curl&quot;,
                &quot;-f&quot;,
                &quot;https://app-endpoint.tld&quot;,
                &quot;&amp;&amp;&quot;,
                &quot;curl&quot;,
                &quot;-fsS&quot;,
                &quot;-m&quot;,
                &quot;10&quot;,
                &quot;--retry&quot;,
                &quot;5&quot;,
                &quot;-o&quot;,
                &quot;/dev/null&quot;,
                &quot;https://healthchecks.io/ping/&lt;UUID&gt;&quot;,
            ]
        interval: 60s
        timeout: 10s
        retries: 6</code></pre><p>Change the first url to the url of your app. The second URL is the endpoint of
your healthchecks.io instance. You can obtain it from the check you configured
earlier.</p><p>This configuration will try to ping your application and, if successful, notify
the healthcheck that the application is healthy. If the app is not reachable or
the container is down, the latter request will not be executed and your service
is marked as &quot;down&quot;.</p><p>In addition to the healthchecks of my docker containers, I also added basic
healthchecks to my servers cronfiles and its backup-commands.</p><p>Do you have any suggestions regarding this topic? Feel free to reach out to me
via Matrix or email!</p><p>This is post 017 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><p>If you enjoyed this post, consider<!-- --> <a href="https://donate.slashdev.space">buying me a coffee</a>! Got comments? Send me a<!-- --> <a href="mailto:garrit@slashdev.space">Mail</a>, or shoot me a message on<!-- --> <a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a>.</p><div class="blog__footer"><h2>Written By: Garrit Franke</h2></div></div><div class="jsx-3897018903 page__footer"></div></article></div><div class="jsx-3553209867 profile"><h2 class="jsx-3553209867">Garrit Franke</h2><p class="jsx-3553209867">Random thoughts, tips and rants about software</p><br class="jsx-3553209867"/><a href="https://garrit.xyz">Website</a><br class="jsx-3553209867"/><a href="https://github.com/garritfra">Github</a><br class="jsx-3553209867"/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br class="jsx-3553209867"/><a href="mailto:garrit@slashdev.space">Email</a><br class="jsx-3553209867"/><a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a><br class="jsx-3553209867"/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP</a><br class="jsx-3553209867"/><a href="/rss.xml">RSS</a></div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteTitle":"~/garrit","frontmatter":{"title":"Docker healthchecks using healthchecks.io","date":"2021-05-15"},"markdownBody":"\nI'm currently in the midst of improving the monitoring of my infrastructure. I\nmake heavy use of docker and docker-compose for my hosting, so it's vital to add\nmonitoring for most of the containers.\n\nI'm hosting my own instance of [healthchecks.io](https://healthchecks.io/).\nTheir solution to monitoring involves **you** having to ping **them**, instead\nof the other way around. This let's you add healthchecks to virtually anything\nthat can ping a http-endpoint.\n\ndocker-compose let's you define healthchecks to your config that, when\ncompleting sucessfully, mark the container as \"healthy\". The process of adding\nsuch a healthcheck is simple. First, create a new check in your healthchecks.io\naccount and set the ping interval to 1 minute, or a value you prefer. Then, add\nthis snippet to your docker-compose file:\n\n```yaml\napp:\n    image: nextcloud\n    ports:\n        - 127.0.0.1:8080:80\n    healthcheck:\n        test:\n            [\n                \"CMD\",\n                \"curl\",\n                \"-f\",\n                \"https://app-endpoint.tld\",\n                \"\u0026\u0026\",\n                \"curl\",\n                \"-fsS\",\n                \"-m\",\n                \"10\",\n                \"--retry\",\n                \"5\",\n                \"-o\",\n                \"/dev/null\",\n                \"https://healthchecks.io/ping/\u003cUUID\u003e\",\n            ]\n        interval: 60s\n        timeout: 10s\n        retries: 6\n```\n\nChange the first url to the url of your app. The second URL is the endpoint of\nyour healthchecks.io instance. You can obtain it from the check you configured\nearlier.\n\nThis configuration will try to ping your application and, if successful, notify\nthe healthcheck that the application is healthy. If the app is not reachable or\nthe container is down, the latter request will not be executed and your service\nis marked as \"down\".\n\nIn addition to the healthchecks of my docker containers, I also added basic\nhealthchecks to my servers cronfiles and its backup-commands.\n\nDo you have any suggestions regarding this topic? Feel free to reach out to me\nvia Matrix or email!\n\nThis is post 017 of [#100DaysToOffload](https://100daystooffload.com/).\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-05-15-healthchecks-io-with-docker"},"buildId":"xx65xxz0JF_KOU9mEOU3_","assetPrefix":"https://blog.garrit.xyz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>